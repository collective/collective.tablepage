(function(e){"use strict";e.fn.rowGrouping=function(t){function n(){}function r(e,t,n){}function i(e,t,n){}function s(e){var t=["January","February","March","April","May","June","July","August","September","October","November","December"];return t[e-1]}var o={iGroupingColumnIndex:0,sGroupingColumnSortDirection:"",iGroupingOrderByColumnIndex:-1,sGroupingClass:"group",sGroupItemClass:"group-item",bHideGroupingColumn:true,bHideGroupingOrderByColumn:true,sGroupBy:"name",sGroupLabelPrefix:"",fnGroupLabelFormat:function(e){return e},bExpandableGrouping:false,bExpandSingleGroup:false,iExpandGroupOffset:100,asExpandedGroups:null,sDateFormat:"dd/MM/yyyy",sEmptyGroupLabel:"-",bSetGroupingClassOnTR:false,iGroupingColumnIndex2:-1,sGroupingColumnSortDirection2:"",iGroupingOrderByColumnIndex2:-1,sGroupingClass2:"subgroup",sGroupItemClass2:"subgroup-item",bHideGroupingColumn2:true,bHideGroupingOrderByColumn2:true,sGroupBy2:"name",sGroupLabelPrefix2:"",fnGroupLabelFormat2:function(e){return e},bExpandableGrouping2:false,fnOnGrouped:n,fnOnGroupCreated:r,fnOnGroupCompleted:i,oHideEffect:null,oShowEffect:null,bUseFilteringForGrouping:false};return this.each(function(n,r){function a(t,n,r){var s=document.createElement("tr");var o=document.createElement("td");s.id="group-id-"+i.attr("id")+"_"+t;var a={id:s.id,key:t,text:n,level:0,groupItemClass:".group-item-"+t,dataGroup:t,aoSubgroups:[]};if(C.bSetGroupingClassOnTR){s.className=C.sGroupingClass+" "+t}else{o.className=C.sGroupingClass+" "+t}o.colSpan=r;o.innerHTML=C.sGroupLabelPrefix+C.fnGroupLabelFormat(n==""?C.sEmptyGroupLabel:n,a);if(C.bExpandableGrouping){if(!l(t)){o.className+=" expanded-group";a.state="expanded"}else{o.className+=" collapsed-group";a.state="collapsed"}o.className+=" group-item-expander";e(o).attr("data-group",a.dataGroup);e(o).attr("data-group-level",a.level);e(o).click(w)}s.appendChild(o);u[t]=a;a.nGroup=s;C.fnOnGroupCreated(a,t,1);return a}function f(t,n,r,i){var s=document.createElement("tr");s.id=i.id+"_"+t;var o=document.createElement("td");var a=i.dataGroup+"_"+t;var f={id:s.id,key:t,text:n,level:i.level+1,groupItemClass:".group-item-"+a,dataGroup:a,aoSubgroups:[]};if(C.bSetGroupingClassOnTR){s.className=C.sGroupingClass2+" "+t}else{o.className=C.sGroupingClass2+" "+t}o.colSpan=r;o.innerHTML=C.sGroupLabelPrefix2+C.fnGroupLabelFormat2(n==""?C.sEmptyGroupLabel:n,f);if(C.bExpandableGrouping){s.className+=" group-item-"+i.dataGroup}if(C.bExpandableGrouping&&C.bExpandableGrouping2){if(!l(f.dataGroup)){o.className+=" expanded-group";f.state="expanded"}else{o.className+=" collapsed-group";f.state="collapsed"}o.className+=" group-item-expander";e(o).attr("data-group",f.dataGroup);e(o).attr("data-group-level",f.level);e(o).click(w)}s.appendChild(o);i.aoSubgroups[f.dataGroup]=f;u[f.dataGroup]=f;f.nGroup=s;C.fnOnGroupCreated(f,t,2);return f}function l(t){if(u[t]!=null)return u[t].state=="collapsed";else if(t.indexOf("_")>-1)return true;else if(N&&(T==null||T.length==0))return false;else return e.inArray(t,T)==-1}function c(e){if(e.length<S+x)return e;else return e.substr(S,x)}function h(e){return e}function p(e){return e.substr(0,1)}function d(e){return c(e)}function v(e){return e.substr(S,x)+" "+s(e.substr(k,L))}function m(t,n){if(t==="")return"-";if(n){t=e.trim(e("<div>"+t+"</div>").text())}return t.toLowerCase().replace(/[^a-zA-Z0-9\u0080-\uFFFF]+/g,"-")}function g(e,t,n){if(e.nTable.id!==i[0].id)return true;var r=t[C.iGroupingColumnIndex];if(typeof r==="undefined")r=t[e.aoColumns[C.iGroupingColumnIndex].mDataProp];if(l(m(r))){if(i.fnIsOpen(i.fnGetNodes(n))){if(C.fnOnRowClosed!=null){C.fnOnRowClosed(this)}i.fnClose(i.fnGetNodes(n))}return false}return true}function y(t){u[t].state="expanded";e("td[data-group^='"+t+"']").removeClass("collapsed-group");e("td[data-group^='"+t+"']").addClass("expanded-group");if(C.bUseFilteringForGrouping){i.fnDraw();return}if(jQuery.inArray(t,T)==-1)T.push(t);if(C.oHideEffect!=null)e(".group-item-"+t,i)[C.oShowEffect.method](C.oShowEffect.duration,C.oShowEffect.easing,function(){});else e(".group-item-"+t,i).show()}function b(t){u[t].state="collapsed";e("td[data-group^='"+t+"']").removeClass("expanded-group");e("td[data-group^='"+t+"']").addClass("collapsed-group");if(C.bUseFilteringForGrouping){i.fnDraw();return}e(".group-item-"+t).each(function(){if(i.fnIsOpen(this)){if(C.fnOnRowClosed!=null){C.fnOnRowClosed(this)}i.fnClose(this)}});if(C.oHideEffect!=null)e(".group-item-"+t,i)[C.oHideEffect.method](C.oHideEffect.duration,C.oHideEffect.easing,function(){});else e(".group-item-"+t,i).hide()}function w(t){var n=e(this).attr("data-group");var r=e(this).attr("data-group-level");var s=!l(n);if(C.bExpandSingleGroup){if(!s){var o=e("td.expanded-group").attr("data-group");b(o);y(n);if(C.iExpandGroupOffset!=-1){var u=e("#group-id-"+i.attr("id")+"_"+n).offset().top-C.iExpandGroupOffset;window.scroll(0,u)}else{var u=i.offset().top;window.scroll(0,u)}}}else{if(s){b(n)}else{y(n)}}t.preventDefault()}function E(t){if(i.fnSettings().oFeatures.bServerSide)N=true;var n=false;if(C.iGroupingColumnIndex2!=-1)n=true;if(t.aiDisplayMaster.length==0){return}var r=e("tbody tr",i);var s=0;for(var o=0;o<t.aoColumns.length;o++){if(t.aoColumns[o].bVisible)s+=1}var c=null;var h=null;if(t.aiDisplay.length>0){for(var p=0;p<r.length;p++){var d=t._iDisplayStart+p;if(i.fnSettings().oFeatures.bServerSide)d=p;var v="";var g=null;var y="";var b=null;v=this.fnGetData(r[p],C.iGroupingColumnIndex);var g=v;if(C.sGroupBy!="year")g=A(v);if(n){y=t.aoData[t.aiDisplay[d]]._aData[C.iGroupingColumnIndex2];if(y==undefined)y=t.aoData[t.aiDisplay[d]]._aData[t.aoColumns[C.iGroupingColumnIndex2].mDataProp];if(C.sGroupBy2!="year")b=A(y)}if(c==null||m(g,true)!=m(c,true)){var w=m(g,true);if(c!=null){C.fnOnGroupCompleted(u[m(c)])}if(C.bAddAllGroupsAsExpanded&&jQuery.inArray(w,T)==-1)T.push(w);var E=a(w,g,s);var S=E.nGroup;if(r[p].parentNode!=null)r[p].parentNode.insertBefore(S,r[p]);else e(r[p]).before(S);c=g;h=null}e(r[p]).attr("data-group",u[w].dataGroup);e(r[p]).addClass(C.sGroupItemClass);e(r[p]).addClass("group-item-"+w);if(C.bExpandableGrouping){if(l(w)&&!C.bUseFilteringForGrouping){e(r[p]).hide()}}if(n){if(h==null||m(b)!=m(h)){var x=m(g)+"-"+m(b);var k=f(x,b,s,u[w]);var L=k.nGroup;r[p].parentNode.insertBefore(L,r[p]);h=b}e(r[p]).attr("data-group",k.dataGroup).addClass(C.sGroupItemClass2).addClass("group-item-"+k.dataGroup)}}}if(c!=null){C.fnOnGroupCompleted(u[m(c)])}C.fnOnGrouped(u);N=false}var i=e(r).dataTable();var u=[];e(this).dataTableExt.aoGroups=u;var S=6;var x=4;var T=[];var N=true;var C=e.extend(o,t);if(C.iGroupingOrderByColumnIndex==-1){C.bCustomColumnOrdering=false;C.iGroupingOrderByColumnIndex=C.iGroupingColumnIndex}else{C.bCustomColumnOrdering=true}if(C.sGroupingColumnSortDirection==""){if(C.sGroupBy=="year")C.sGroupingColumnSortDirection="desc";else C.sGroupingColumnSortDirection="asc"}if(C.iGroupingOrderByColumnIndex2==-1){C.bCustomColumnOrdering2=false;C.iGroupingOrderByColumnIndex2=C.iGroupingColumnIndex2}else{C.bCustomColumnOrdering2=true}if(C.sGroupingColumnSortDirection2==""){if(C.sGroupBy2=="year")C.sGroupingColumnSortDirection2="desc";else C.sGroupingColumnSortDirection2="asc"}S=C.sDateFormat.toLowerCase().indexOf("yy");x=C.sDateFormat.toLowerCase().lastIndexOf("y")-C.sDateFormat.toLowerCase().indexOf("y")+1;var k=C.sDateFormat.toLowerCase().indexOf("mm");var L=C.sDateFormat.toLowerCase().lastIndexOf("m")-C.sDateFormat.toLowerCase().indexOf("m")+1;var A=h;switch(C.sGroupBy){case"letter":A=p;break;case"year":A=d;break;case"month":A=v;break;default:A=h;break}if(C.asExpandedGroups!=null){if(C.asExpandedGroups=="NONE"){C.asExpandedGroups=[];T=C.asExpandedGroups;N=false}else if(C.asExpandedGroups=="ALL"){C.bAddAllGroupsAsExpanded=true}else if(C.asExpandedGroups.constructor==String){var O=C.asExpandedGroups;C.asExpandedGroups=[];C.asExpandedGroups.push(m(O));T=C.asExpandedGroups;N=false}else if(C.asExpandedGroups.constructor==Array){for(var M=0;M<C.asExpandedGroups.length;M++){T.push(m(C.asExpandedGroups[M]));if(C.bExpandSingleGroup)break}N=false}}else{C.asExpandedGroups=[];C.bAddAllGroupsAsExpanded=true}if(C.bExpandSingleGroup){var _=e("tbody tr",i);var D=i.fnGetData(_[0],C.iGroupingColumnIndex);var P=D;if(C.sGroupBy!="year")P=A(D);var H=m(P);C.asExpandedGroups=[];C.asExpandedGroups.push(H)}i.fnSetColumnVis(C.iGroupingColumnIndex,!C.bHideGroupingColumn);if(C.bCustomColumnOrdering){i.fnSetColumnVis(C.iGroupingOrderByColumnIndex,!C.bHideGroupingOrderByColumn)}if(C.iGroupingColumnIndex2!=-1){i.fnSetColumnVis(C.iGroupingColumnIndex2,!C.bHideGroupingColumn2)}if(C.bCustomColumnOrdering2){i.fnSetColumnVis(C.iGroupingOrderByColumnIndex2,!C.bHideGroupingOrderByColumn2)}i.fnSettings().aoDrawCallback.push({fn:E,sName:"fnRowGrouping"});var B=[];B.push([C.iGroupingOrderByColumnIndex,C.sGroupingColumnSortDirection]);if(C.iGroupingColumnIndex2!=-1){B.push([C.iGroupingOrderByColumnIndex2,C.sGroupingColumnSortDirection2])}i.fnSettings().aaSortingFixed=B;switch(C.sGroupBy){case"name":break;case"letter":i.fnSettings().aoColumns[C.iGroupingOrderByColumnIndex].sSortDataType="rg-letter";e.fn.dataTableExt.afnSortData["rg-letter"]=function(t,n){var r=[];e("td:eq("+n+")",t.oApi._fnGetTrNodes(t)).each(function(){r.push(p(this.innerHTML))});return r};break;case"year":i.fnSettings().aoColumns[C.iGroupingOrderByColumnIndex].sSortDataType="rg-date";e.fn.dataTableExt.afnSortData["rg-date"]=function(e,t){var n=[];var r=e.oApi._fnGetTrNodes(e);for(M=0;M<r.length;M++){n.push(c(i.fnGetData(r[M],t)))}return n};break;default:break}if(C.bUseFilteringForGrouping)e.fn.dataTableExt.afnFiltering.push(g);i.fnDraw()})}})(jQuery)